<!DOCTYPE html>
<html>
<head>
<style>
  table {
    width: 150px;
  };
  td {
    width: 75px;
  }
</style>
<title>Cookies</title>
</head>
<body>

<h3>Cookies with sensitive information</h3>

<!-- First part of webpage: Type CPR number -->

<p>
<h4>Type and store your CPR number as a cookie</h4>
</p>
 
<p>
Type CPR:
<input type="cpr" id="cpr" name="cpr" size="8">
<button onclick = "cpr_done()">CPR done</button>
<i id="cpr_status"></i>
</p>

The data in the CPR input field ..
<vspace -0.2cm>
<ul>
<li>.. is stored <i>temporarily</i> in the browser's cache along with images and more</li>
<li>the cache may be cleared automatically if the memory space is needed for other purposes</li>
</ul>

<br>

<!-- Second part of webpage: Show CPR cookie -->

<h4>Show CPR cookie</h4>

<table>
<tr>
<td>
<table width="200">
<tr>
  <td><i>name</i></td>
  <td><i>value</i></td>
</tr>
<tr>
  <td>CPR</td>
  <td id="show_cpr"></td>
</tr>
</table>
</td>
<th id="cookieimg" width="100">

</th>
</tr>
</table>

<p>
<button onclick = "remove_cpr_cookie()">Remove CPR cookie</button>
</p>

The CPR cookie ..
<ul>
<li>.. is stored <i>persistently</i> in this example (well, for a year)</li>
<li>until removed explicitly by clicking botton</li>
<li>(if explicitly removed, disappears when page is reloaded)
</ul>

<script>
// Functions triggered in first part of webpage (Type CPR number)

// cpr_done() creates/resets a cookie
// if the user types a correct CPR number
// ("correct" if it contains exactly ten characters..)

function cpr_done() {
  var txt = document.getElementById("cpr").value;
  var status = "<i style='color:red;'>CPR not OK, not stored as cookie</i>";
  if (txt.length == 10) {   
    status = "<i style='color:green;'>CPR OK and stored as cookie</i>";
    set_persistent_cookie("cpr", txt);
  }
  document.getElementById("cpr_status").innerHTML = status;
  show_cpr_cookie();
};

function set_persistent_cookie(name, value) {
  document.cookie = name + "=" + value + "; max-age=31536000";
  // max-age set to one year (milliseconds)
};

// Functions triggered in second part of webpage (Show CPR cookie)

function show_cpr_cookie() {
  var cookie_value = read_cookie("cpr");
  if (cookie_value == "") {
    document.getElementById("show_cpr").innerHTML = "(no cookie)";
    document.getElementById("cookieimg").innerHTML = ""; 
  }
  else {
    document.getElementById("show_cpr").innerHTML = cookie_value;
    document.getElementById("cookieimg").innerHTML 
      = '<img id="img" src = "cookie.png" width = "40" heigth = "40">';
  }
}

function remove_cpr_cookie() {
  document.cookie = "cpr=; expires = Thu, 01 Jan 1970 00:00:00 GMT";
};

function read_cookie(searchname) {
  var allcookies = document.cookie;
  var cookiearray = allcookies.split(';');
  length = cookiearray.length;
  for (var i=0; i<cookiearray.length; i++) {
    let name = cookiearray[i].split('=')[0];
    let value = cookiearray[i].split('=')[1];
    if (name == searchname) return value;
  }
  return "";
};

// Code executed when page is loaded

show_cpr_cookie();
</script>

</body>
</html>
